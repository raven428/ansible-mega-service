---
- name: Destroy packages remove
  ansible.builtin.include_role:
    name: ansible-mega-var
    tasks_from: _apt.yaml
  vars:
    meva_packages: "{{ mesv_install_pkgs | default([]) | map('combine',
      {'state': 'absent', 'autoremove': true, 'purge': true}) | list }}"

- name: Destroy users keys
  ansible.builtin.include_role:
    name: ansible-mega-var
    tasks_from: _key.yaml
  vars:
    meva_key2user: "{{ mesv_install_key2user | default([]) | map('combine',
      {'state': 'absent'}) | list }}"

- name: Destroy users remove
  ansible.builtin.include_role:
    name: ansible-mega-var
    tasks_from: _user.yaml
  vars:
    meva_users2create: "{{ mesv_install_users | default([]) | map('combine',
      {'state': 'absent'}) | list }}"

- name: Destroy groups remove
  ansible.builtin.include_role:
    name: ansible-mega-var
    tasks_from: _group.yaml
  vars:
    meva_groups2create: "{{ mesv_install_groups | default([]) | map('combine',
      {'state': 'absent'}) | list }}"

- name: Destroy dirs remove
  ansible.builtin.include_role:
    name: ansible-mega-var
    tasks_from: _file.yaml
  vars:
    meva_dirs2create: "{{ (mesv_install_templates | default([]) + mesv_config_templates |
      default([]) + mesv_remove_entries | default([])) | map(attribute='dest') |
      map('community.general.dict_kv', 'name') | map('combine', {'state': 'absent'}) |
      list }}"
